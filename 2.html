<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		<title>FMS_Cat - ツマミ怖くないっ！シンセ講座 第一回 オシレータ ( Saw, Square, Triangle, Sine )</title>
   		<link rel="stylesheet" href="./github-markdown.css">
		<style type="text/css">
			body
			{
				font-family: 'Helvetica Neue' , Helvetica , Arial , Verdana;
				background-color: #FFFFFF;
			}

			#article
			{
				position: fixed;
				top: 0px;
				left: 0px;
				padding: 16px;
				margin: 0px;
				overflow-x: hidden;
				overflow-y: scroll;
			}

			#synth
			{
				position: fixed;
				bottom: 0px;
				left: 0px;
				padding: 8px;
				margin: 8px;
				width: 640px;
				height: 240px;
				background-color: #222222;
			}

			#console
			{
				position: fixed;
				bottom: 0px;
				right: 0px;
				padding: 8px;
				margin: 8px;
				height: 240px;
				color: #FFFFFF;
				background-color: #222222;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<div id="article" class="markdown-body" style="width:640px;height:320px;">
#ツマミ怖くないっ！シンセ講座

##第二回 エンベロープ <span style="font-size:16px;">( Amp, ADSR )</span>

現在作業中。エンベロープの挙動（特にアタックを長くしてスタッカートを弾いた時）がおかしいです。
		</div>
		<div style="position:fixed;bottom:0px;left:0px;margin:0px;padding:0px;width:100%;height:272px;background-color:#FFFFFF;">
			<div id="synth">
				<div style="position:absolute;left:58px;top:20px;width:540px;height:120px">
					<svg viewBox="0 0 540 120" width="540" height="120">
						<path stroke="#FFFFFF" id="envGraph" stroke-width="2" fill="#666666" d=""/>
						<path stroke="#FF0066" id="envGraphA" stroke-width="4" d=""/>
						<path stroke="#00FF66" id="envGraphD" stroke-width="4" d=""/>
						<path stroke="#0066FF" id="envGraphR" stroke-width="4" d=""/>
					</svg>
				</div>
				<div style="position:absolute;left:8px;top:150px">
					<div style="position:absolute;left:60px;"><input type="text" value=".2" id="envA"></div>
					<div style="position:absolute;left:200px;"><input type="text" value=".4" id="envD"></div>
					<div style="position:absolute;left:340px;"><input type="text" value=".6" id="envS"></div>
					<div style="position:absolute;left:480px;"><input type="text" value=".3" id="envR"></div>
				</div>
			</div>
			<div id="console" style="width: 0px;visibility:visible;">
			</div>
		</div>

		<script src="./js/marked.js"></script>
		<script src="./js/timbre.js" type="text/javascript"></script>
		<script src="./js/jquery.js" type="text/javascript"></script>
		<script src="./js/jquery.knob.js" type="text/javascript"></script>
		<script src="./js/k2n.js" type="text/javascript"></script>
		<script>
			document.getElementById("article").innerHTML=marked(document.getElementById("article").innerHTML);

			function resize()
			{
				document.getElementById("article").style.width=""+(window.innerWidth-32)+"px";
				document.getElementById("article").style.height=""+(window.innerHeight-272-32)+"px";
				if(window.innerWidth-640-32-24<16)
				{
					document.getElementById("console").style.visibility="hidden";
				}
				else
				{
					document.getElementById("console").style.visibility="visible";
					document.getElementById("console").style.width=""+(window.innerWidth-640-32-24)+"px";
				}
			}
			resize();
			window.onresize=resize;

			var conRow=0;
			function con(str,clr)
			{
				var temp=document.getElementById("console").innerHTML;
				document.getElementById("console").innerHTML=temp+"<span style=\"color:"+clr+";\">"+str+"</span><br>";
				var temp=document.getElementById("console").innerHTML;
				conRow++;
				if(13<conRow)
				{
					conRow--;
					document.getElementById("console").innerHTML=temp.slice(temp.indexOf("<br>")+4);
				}
			}

			var osc,env;
			var osc=T("saw");
			var env=T("adsr",{a:10,d:10,s:1,r:10});
			var synth=T("OscGen",{osc:osc,env:env,mul:.25}).play();

			var isOn=[];
			for(var c=0;c<80;c++)
			{
				isOn.push(false);
			}

			document.onkeydown=function()
			{
				var note=k2n(window.event.keyCode);
				if(note!==0&&!(isOn[note]))
				{
					synth.noteOn(note,64);
					isOn[note]=true;
					con("note on: "+note,"#FFFFFF");
				}
			}

			document.onkeyup=function()
			{
				var note=k2n(window.event.keyCode);
				if(note!==0&&isOn[note])
				{
					synth.noteOff(note,64);
					isOn[note]=false;
					con("note off: "+note,"#BBBBBB");
				}
			}

			var envA=0.2,envD=0.4,envS=0.6,envR=0.3;

			function changeEnvGraph()
			{
				document.getElementById("envGraph").setAttribute("d","M 0 110 l "+envA*180+" -110 l "+envD*180+" "+(1-envS)*110+" l "+envR*180+" "+envS*110+" M 0 110 z");
				document.getElementById("envGraphA").setAttribute("d","M 0 115 h "+envA*180+"");
				document.getElementById("envGraphD").setAttribute("d","M 0 115 m "+envA*180+" 0 h "+envD*180+"");
				document.getElementById("envGraphR").setAttribute("d","M 0 115 m "+envA*180+" 0 m "+envD*180+" 0 h "+envR*180+"");
			}

			function changeEnv()
			{
				var _table=[0.,[1.,envA*1000.],[envS,envD*1000.],[0.,envR*1000.]];
				synth.env=T("env",{table:_table,releaseNode:3});
				changeEnvGraph();
			}

			changeEnv();

			function round2(num,dec)
			{
				num*=Math.pow(10,dec);
				num=Math.round(num);
				return num/Math.pow(10,dec);
			}

			function releaseEnv(num)
			{
				switch(num)
				{
					case 0: con("env change: a: "+round2(envA,2),"#00FF66");break;
					case 1: con("env change: d: "+round2(envD,2),"#00FF66");break;
					case 2: con("env change: s: "+round2(envS,2),"#00FF66");break;
					case 3: con("env change: r: "+round2(envR,2),"#00FF66");break;
				}
			}

			$(function()
			{
				var knobTemp={"min":0,"max":1,"step":.001,"thickness":.6,"angleOffset":-150,"angleArc":300,"width":96,"displayInput":false,"bgColor":"#333333"};
				$("#envA").knob($.extend(true,{"fgColor":"#FF0066","change":function(v){envA=v;changeEnv();},"release":function(){releaseEnv(0);}},knobTemp));
				$("#envD").knob($.extend(true,{"fgColor":"#00FF66","change":function(v){envD=v;changeEnv();},"release":function(){releaseEnv(1);}},knobTemp));
				$("#envS").knob($.extend(true,{"fgColor":"#FFFFFF","change":function(v){envS=v;changeEnv();},"release":function(){releaseEnv(2);}},knobTemp));
				$("#envR").knob($.extend(true,{"fgColor":"#0066FF","change":function(v){envR=v;changeEnv();},"release":function(){releaseEnv(3);}},knobTemp));
			});
		</script>
	</body>
</html>