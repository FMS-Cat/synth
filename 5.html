<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		<title>FMS_Cat - ツマミ怖くないっ！シンセ講座 第5回 フィルター (2) ( LPF + Envelope, LFO )</title>
   		<link rel="stylesheet" href="./css/github-markdown.css">
		<link rel="stylesheet" href="./css/style.css">
		<style type="text/css">
			strong
			{
				background: #FFFF00;
			}

			.preset
			{
				font-size: 24px;
			}
		</style>
	</head>
	<body>
		<div id="article" class="markdown-body" style="width:640px;height:320px;">
#[ツマミ怖くないっ！シンセ講座](http://fms-cat.github.io/synth/)

##第5回 フィルター (2) <span style="font-size:16px;">( LPF + Envelope, LFO )</span>

今回は、[第3回](./3.html)に紹介した**フィルター**を、[第2回](./2.html)に紹介した**エンベロープ**や、[第4回](./4.html)に紹介した**LFO**で制御してみましょう。  
ある意味、**今までの総復習**のような内容になると思います。  
**…ツマミが多い！！** と思ったあなた、ご安心ください。**新しい概念は1つ**のみしか出てきません。

では先に新しい概念だけ済ませてしまいましょう。  
左下の **Range** という白いツマミです。  
**オクターブを上下させる**ことができます。それだけです。  
パソコンのキーボードだけだと約2オクターブしか出すことが出来ないため、必要かと思いつけました。

さて、ここからは今までの復習をしながら、今回のパネルの説明をしていきたいと思います。  

- #### Oscillatorセクション
左側の白い部分が**Oscillatorセクション**です。**フィルターで加工する前**の生の音を作る部分です。  
Oscillatorでオシレータの波形を選び（[第1回](./1.html)でやったやつ）、Rangeでオクターブを選びます。  
今回はフィルターを用いた加工が主役となりますが、ここは**フィルターを通す前の音を作る**部分です。

- #### <span style="color:#0066FF">Filterセクション</span>
右側の青い部分が**Filterセクション**です。  
[第3回](./3.html)でやったパラメータがそのまま2つあることがわかります。  
また、フィルターはよく使うパラメータなので、フィルターのツマミは大きいことが多いですね。

- #### <span style="color:#FF0066">Envelopeセクション</span>
真ん中上の赤い部分が**Envelopeセクション**です。  
[第2回](./2.html)ではエンベロープを音量に割り当てていましたが、今回は**エンベロープをフィルターに割り当てました**。  
つまり、**ここのエンベロープにより、青くてデカいCutoffのパラメータが変わります（見た目上は変わらない）**。  
赤の **Amount** ツマミによって、エンベロープを**Cutoffに送る割合**を設定します。  
つまり、Amountが0だとEnvelopeセクションは全く意味を持ちません。  
また、[第2回](./2.html)ではADSRという4つのパラメータを持つエンベロープを紹介しましたが、今回はAttackとDecayの**2つのパラメータ**しか使いません。  
また、Decayのツマミを最大にした時にDecayの時間が∞となるようにしました。ちょっと音を作りやすくする工夫です。

- #### <span style="color:#00DD66">LFOセクション</span>
真ん中下の緑の部分が**LFOセクション**です。  
[第4回](./4.html)ではLFOをビブラートとして音程に割り当てましたが、今回は**LFOもフィルターに割り当てました**。  
つまり、**ここのLFOにより、青くてデカいCutoffのパラメータが変わります（見た目上は変わらない）**。エンベロープと全く同じですね。  
緑の **Amount** ツマミによって、LFOを**Cutoffに送る割合**を設定します。  
つまり、Amountが0だとLFOセクションは全く意味を持ちません。  
今回はAttackパラメータはつけていません。

### プリセット

ここまで説明をしてみて、いまひとつ感覚がつかめないと思います。  
**シンセの使い方や傾向はプリセットから分かる**ことも多いので、プリセットを見てみましょう。  

- <a class="preset" onclick="preset(10,0,400,99999999,.5,5,0,3,0)">Brass</a>  
金管楽器のような音ですね。  
**エンベロープのAttack**を長くし、フィルターを時間的に変化させることで、音に表情がつきました。

- <a class="preset" onclick="preset(10,0,0,200,.8,5,0,3,0)">Pluck</a>  
弦を弾いたような音です。  
エンベロープのAttackを0にして、**Decayを短く**した状態でAmountを上げるとこういった音が出ます。    
[第二回](./2.html)では音量をエンベロープに割り当てて同じような音を出しましたが、フィルターだとまた違ったニュアンスが出ます。

- <a class="preset" onclick="preset(50,17,0,300,.3,5,0,1,0)">Acid</a>  
ローランドから発売された、TB-303というベースシンセに代表される音です。  
**Resonance**がかかった状態でPluckのようにフィルターを変化させることでこういった音が出ます。  
<iframe width="420" height="315" src="//www.youtube.com/embed/2c4l6ZacNjg" frameborder="0" allowfullscreen></iframe>

- <a class="preset" onclick="preset(1500,12,200,400,0,5,.15,1,1)">Wobble</a>  
とても安っぽいワブルベースの音が出来ました。  
一定周期でフィルターなどを用いた音の変化がつくベース音をワブルベースと言います。  
今回は**LFOを用いてフィルターを周期的に変化**させています。  
ダブステップと呼ばれる音楽で多用されますね。

- <a class="preset" onclick="preset(1500,36,200,400,0,1,.15,0,0)">Resonance Noise</a>  
**Resonanceの値を極端に大きくする**ことでこういった音が得られます。  
ノコギリ波の鋭く変化する部分がはっきりと聞こえると思います。

---

今回は使うツマミがとても多く、大変だったかもしれませんが、**一つ一つのツマミが持つ意味はとても単純**です。  
**実際のシンセも同様**で、一つ一つのツマミの意味をしっかり認識すれば使いこなすことができます。  
もし、使い方が全くわからなければ、**プリセットを試してみながら理解する**のも手です。  

一応、この第5回でシンプルなシンセの使い方の解説はすべて終了したと思います。  
次回以降何をするかはまったく決めていないため、要望がありましたら是非 [@FMS_Cat](http://twitter.com/FMS_Cat) までお願いします。 
		</div>
		<div style="position:fixed;bottom:0px;left:0px;margin:0px;padding:0px;width:100%;height:272px;background-color:#FFFFFF;">
			<div id="synth">
				<div style="position:absolute;left:30px;top:25px;">
					<div style="position:absolute;left:10px;top:80px;width:80px;color:#FFFFFF;" align="center">Oscillator</div>
					<div style="position:absolute;left:330px;top:190px;width:200px;color:#0066FF;" align="center">Cutoff</div>
					<div style="position:absolute;left:530px;top:190px;width:50px;color:#66BBFF;" align="center">Res</div>
					<div style="position:absolute;left:110px;top:80px;width:50px;color:#FF66BB;" align="center">Attack</div>
					<div style="position:absolute;left:170px;top:80px;width:50px;color:#FF66BB;" align="center">Decay</div>
					<div style="position:absolute;left:230px;top:80px;width:80px;color:#FF0066;" align="center">Amount</div>
					<div style="position:absolute;left:170px;top:190px;width:50px;color:#66FFBB;" align="center">Freq</div>
					<div style="position:absolute;left:230px;top:190px;width:80px;color:#00FF66;" align="center">Amount</div>
					<div style="position:absolute;left:10px;top:190px;width:80px;color:#FFFFFF;" align="center">Range</div>
				</div>
				<div style="position:absolute;left:30px;top:25px">
					<img src="./img/saw1.svg" id="osc0" onClick="changeOsc(0)" width="36" height="36" style="position:absolute;left:10px;top:0px;">
					<img src="./img/squ.svg" id="osc1" onClick="changeOsc(1)" width="36" height="36" style="position:absolute;left:52px;top:0px;">
					<img src="./img/tri.svg" id="osc2" onClick="changeOsc(2)" width="36" height="36" style="position:absolute;left:10px;top:42px;">
					<img src="./img/sin.svg" id="osc3" onClick="changeOsc(3)" width="36" height="36" style="position:absolute;left:52px;top:42px;">

					<div style="position:absolute;left:330px;top:0px"><input type="text" value="1." id="lpfC"></div>
					<div style="position:absolute;left:530px;top:142px"><input type="text" value=".0" id="lpfR"></div>
					<div style="position:absolute;left:110px;top:32px"><input type="text" value=".2" id="envA"></div>
					<div style="position:absolute;left:170px;top:32px"><input type="text" value=".4" id="envD"></div>
					<div style="position:absolute;left:230px;top:4px"><input type="text" value=".0" id="envAm"></div>
					<div style="position:absolute;left:170px;top:142px;"><input type="text" value=".25" id="lfoF"></div>
					<div style="position:absolute;left:230px;top:114px;"><input type="text" value=".0" id="lfoAm"></div>
					<div style="position:absolute;left:10px;top:114px;"><input type="text" value="2" id="range"></div>

					<svg viewBox="-2 -2 102 32" width="104" height="34" style="position:absolute;left:111px;top:-6px">
						<path stroke="#FFFFFF" id="envGraph" stroke-width="2" fill="#444444" d="M 0 0"/>
					</svg>
					<svg viewBox="-2 -2 102 32" width="104" height="34" style="position:absolute;left:111px;top:104px">
						<path stroke="#FFFFFF" id="lfoGraph" stroke-width="2" fill="none" stroke-linejoin="round" d="M 0 0"/>
					</svg>
				</div>
			</div>
			<div id="console" style="width: 0px;visibility:visible;">
			</div>
		</div>

		<script src="./js/marked.js"></script>
		<script src="./js/timbre.js" type="text/javascript"></script>
		<script src="./js/jquery.js" type="text/javascript"></script>
		<script src="./js/jquery.knob.js" type="text/javascript"></script>
		<script src="./js/k2n.js" type="text/javascript"></script>
		<script src="./js/style.js" type="text/javascript"></script>

		<script>
			var synth=T("SynthDef").play();
			var oscIsSaw=T("param",{value:1.});
			var oscIsSqu=T("param",{value:0.});
			var oscIsTri=T("param",{value:0.});
			var oscIsSin=T("param",{value:0.});
			var lpfC=T("param", {value:10000});
			var lpfCs=T("param", {value:0});
			var lpfR=T("param", {value:0});
			var envA=T("param", {value:200});
			var envD=T("param", {value:400});
			var envAm=T("param", {value:0});
			var lfoF=T("param", {value:5});
			var lfoAm=T("param", {value:0});
			var range=T("param",{value:.5});

			synth.def = function(opts)
			{
				var freq=T("*",opts.freq,range);
				var oscSaw=T("*",T("saw",{freq:freq,mul:.25}),oscIsSaw);
				var oscSqu=T("*",T("square",{freq:freq,mul:.25}),oscIsSqu);
				var oscTri=T("*",T("tri",{freq:freq,mul:.25}),oscIsTri);
				var oscSin=T("*",T("sin",{freq:freq,mul:.25}),oscIsSin);
				var osc=T("+",oscSaw,oscSqu,oscTri,oscSin);
				var cutEnv=T("env",{table:[0.,[1.,envA.value],[0.,envD.value,],0.],releaseNode:3}).bang();
				var cutLfo=T("sin",{freq:lfoF});
				var cut=T("+", lpfC , T("*",cutEnv,envAm,10000) , T("*",cutLfo,lfoAm,10000) );
				var lpf=T("lpf",{cutoff:cut,Q:lpfR},osc);
				var env=T("env",{table:[1.,0.],releaseNode:1}, lpf);
				return env.on("ended", opts.doneAction).bang();
			};

			function showGraph()
			{
				document.getElementById("envGraph").setAttribute("d","M 0 30 l "+envA.value/1000*50+" "+envAm.value*(-30)+" l "+envD.value/1000*50+" "+envAm.value*30+" h 100 M 0 30 z");
				var lfoSin="M 0 15";
				for(var c=0;c<100;c++)
				{
					lfoSin=lfoSin+"L "+c+" "+(15.+Math.sin(c*.03*lfoF.value)*(-15.)*lfoAm.value);
				}
				document.getElementById("lfoGraph").setAttribute("d",lfoSin);
			}
			showGraph();

			var isOn=[];
			for(var c=0;c<80;c++)
			{
				isOn.push(false);
			}

			document.onkeydown=function()
			{
				var note=k2n(window.event.keyCode);
				if(note!==0&&!(isOn[note]))
				{
					synth.noteOn(note,64);
					isOn[note]=true;
					con("note on: "+note,"#FFFFFF");
				}
			}

			document.onkeyup=function()
			{
				var note=k2n(window.event.keyCode);
				if(note!==0&&isOn[note])
				{
					synth.noteOff(note,64);
					isOn[note]=false;
					con("note off: "+note,"#BBBBBB");
				}
			}

			function changeKnob(target,param)
			{
				switch(target)
				{
					case 0: lpfC.value=(10+param*9990);break;
					case 1: lpfR.value=(param*40.);break;
					case 2: envA.value=(param*1000.);break;
					case 3: 
						if(param<.99)
						{
							envD.value=(param*1000.);break;	
						}
						else
						{
							envD.value=99999999.;break;
						}
					case 4: envAm.value=(param);break;
					case 5: lfoF.value=(param*20.);break;
					case 6: lfoAm.value=(param);break;
					case 7: range.value=(Math.pow(2,Math.floor(param-2.5)));break;
				}
				showGraph();
			}

			function round2(num,dec)
			{
				num*=Math.pow(10,dec);
				num=Math.round(num);
				return num/Math.pow(10,dec);
			}

			function releaseKnob(num)
			{
				switch(num)
				{
					case 0: con("lpf cutoff: "+round2(lpfC.value,0)+" Hz","#0066FF");break;
					case 1: con("lpf resonance: "+round2(lpfR.value/40.,2)+"","#0066FF");break;
					case 2: con("lpf envelope a: "+round2(envA.value,0)+" ms","#FF0066");break;
					case 3: 
						if(envD.value<990)
						{
							con("lpf envelope d: "+round2(envD.value,0)+" ms","#FF0066");break;
						}
						else
						{
							con("lpf envelope d: infinity","#FF0066");break;
						}
					case 4: con("lpf envelope amount: "+round2(envAm.value,2)+"","#FF0066");break;
					case 5: con("lpf lfo frequency: "+round2(lfoF.value,0)+" Hz","#00FF66");break;
					case 6: con("lpf lfo amount: "+round2(lfoAm.value,2)+"","#00FF66");break;
					case 7: con("osc range: "+(1/range.value*8)+"'","#FFFFFF");break;
				}
			}

			function preset(a,b,c,d,e,f,g,h,i)
			{
				lpfC.value=a;
				lpfR.value=b;
				envA.value=c;
				envD.value=d;
				envAm.value=e;
				lfoF.value=f;
				lfoAm.value=g;
				range.value=(Math.pow(2,Math.floor(h-2.5)));
				$("#lpfC").val(a/10000.).trigger("change");
				$("#lpfR").val(b/40.).trigger("change");
				$("#envA").val(c/1000.).trigger("change");
				$("#envD").val(d/1000.).trigger("change");
				$("#envAm").val(e).trigger("change");
				$("#lfoF").val(f/20.).trigger("change");
				$("#lfoAm").val(g).trigger("change");
				$("#range").val(h).trigger("change");
				changeOsc(i);
				showGraph();
			}

			function changeOsc(i)
			{
				oscIsSaw.value=i===0?1.:0.;
				oscIsSqu.value=i===1?1.:0.;
				oscIsTri.value=i===2?1.:0.;
				oscIsSin.value=i===3?1.:0.;
				document.getElementById("osc0").src=i===0?"./img/saw1.svg":"./img/saw.svg";
				document.getElementById("osc1").src=i===1?"./img/squ1.svg":"./img/squ.svg";
				document.getElementById("osc2").src=i===2?"./img/tri1.svg":"./img/tri.svg";
				document.getElementById("osc3").src=i===3?"./img/sin1.svg":"./img/sin.svg";
				if(i===0){con("osc wave: saw","#FFFFFF");}
				if(i===1){con("osc wave: square","#FFFFFF");}
				if(i===2){con("osc wave: triangle","#FFFFFF");}
				if(i===3){con("osc wave: sine","#FFFFFF");}
			}

			$(function()
			{
				var knobTemp={"min":0,"max":1,"step":.001,"thickness":.6,"angleOffset":-150,"angleArc":300,"displayInput":false,"bgColor":"#333333"};
				$("#lpfC").knob($.extend(true,knobTemp,{"width":200,"fgColor":"#0066FF","change":function(v){changeKnob(0,v);},"release":function(){releaseKnob(0);}}));
				$("#lpfR").knob($.extend(true,knobTemp,{"width":50,"fgColor":"#66BBFF","change":function(v){changeKnob(1,v);},"release":function(){releaseKnob(1);}}));
				$("#envA").knob($.extend(true,knobTemp,{"width":50,"fgColor":"#FF66BB","change":function(v){changeKnob(2,v);},"release":function(){releaseKnob(2);}}));
				$("#envD").knob($.extend(true,knobTemp,{"width":50,"fgColor":"#FF66BB","change":function(v){changeKnob(3,v);},"release":function(){releaseKnob(3);}}));
				$("#envAm").knob($.extend(true,knobTemp,{"width":80,"fgColor":"#FF0066","change":function(v){changeKnob(4,v);},"release":function(){releaseKnob(4);}}));
				$("#lfoF").knob($.extend(true,knobTemp,{"width":50,"fgColor":"#66FFBB","change":function(v){changeKnob(5,v);},"release":function(){releaseKnob(5);}}));
				$("#lfoAm").knob($.extend(true,knobTemp,{"width":80,"fgColor":"#00FF66","change":function(v){changeKnob(6,v);},"release":function(){releaseKnob(6);}}));
				$("#range").knob($.extend(true,knobTemp,{"width":80,"max":5,"step":1,"fgColor":"#FFFFFF","change":function(v){changeKnob(7,v);},"release":function(){releaseKnob(7);}}));
			});
		</script>
	</body>
</html>